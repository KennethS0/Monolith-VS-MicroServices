events {
    worker_connections 1024;
}

http {
    upstream users {
        server user-service:3000;
    }
    
    upstream products {
        server product-service:3000;
    }
    
    upstream orders {
        server order-service:3000;
    }
    
    upstream notifications {
        server notification-service:3000;
    }
    
    server {
        listen 80;
        
        # Página principal de la ciudad
        location / {
            return 200 '<!DOCTYPE html>
<html>
<head>
    <title>🏙️ Ciudad de Microservicios</title>
    <style>
        body { font-family: Arial; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; }
        .ciudad { text-align: center; }
        .servicio { background: rgba(255,255,255,0.1); margin: 10px; padding: 15px; border-radius: 8px; display: inline-block; width: 200px; }
        .servicio:hover { background: rgba(255,255,255,0.2); transform: scale(1.05); transition: all 0.3s; }
    </style>
</head>
<body>
    <div class="ciudad">
        <h1>🏙️ Bienvenido a la Ciudad de Microservicios</h1>
        <p>Cada servicio es independiente pero trabajan juntos</p>
        
        <div class="servicio">
            <h3>👤 Usuarios</h3>
            <p><a href="/api/users/health" style="color: #FFD700;">Estado del Servicio</a></p>
        </div>
        
        <div class="servicio">
            <h3>📦 Productos</h3>
            <p><a href="/api/products/health" style="color: #FFD700;">Estado del Servicio</a></p>
        </div>
        
        <div class="servicio">
            <h3>🛒 Pedidos</h3>
            <p><a href="/api/orders/health" style="color: #FFD700;">Estado del Servicio</a></p>
        </div>
        
        <div class="servicio">
            <h3>📧 Notificaciones</h3>
            <p><a href="/api/notifications/health" style="color: #FFD700;">Estado del Servicio</a></p>
        </div>
        
        <div class="servicio">
            <h3>📊 Monitor</h3>
            <p><a href="http://localhost:9090" style="color: #FFD700;">Prometheus</a></p>
        </div>
    </div>
</body>
</html>';
            add_header Content-Type text/html;
        }
        
        # Rutas de los microservicios
        location /api/users/ {
            proxy_pass http://users/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        
        location /api/products/ {
            proxy_pass http://products/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        
        location /api/orders/ {
            proxy_pass http://orders/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        
        location /api/notifications/ {
            proxy_pass http://notifications/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
    }
}
